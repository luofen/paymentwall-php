<?php 
require_once './lib/paymentwall.php';
Paymentwall_Config::getInstance()->set(array(
'private_key' => 'YOUR_PRIVATE_KEY'
));

$parameters = $_POST;
$cardInfo = array(
		'email' => $parameters['email'],
		'amount' => 9.99,
		'currency' => 'USD',
		'token' => $parameters['brick_token'],
		'fingerprint' => $parameters['brick_fingerprint'],
		'description' => 'Order #123'
);

if (isset($parameters['brick_charge_id']) AND isset($parameters['brick_secure_token'])) {
	$cardInfo['charge_id'] = $parameters['brick_charge_id'];
	$cardInfo['secure_token'] = $parameters['brick_secure_token'];
}

$charge = new Paymentwall_Charge();
$charge->create($cardInfo);
$responseData = json_decode($charge->getRawResponseData(),true);
$response = $charge->getPublicData();

if ($charge->isSuccessful() AND empty($responseData['secure'])) {
	if ($charge->isCaptured()) {
		// deliver a product
	} elseif ($charge->isUnderReview()) {
		// decide on risk charge
	}
} elseif (!empty($responseData['secure'])) {
	$response = json_encode(array('secure' => $responseData['secure']));
} else {
	$errors = json_decode($response, true);
}

echo $response;

?>


<script src="https://api.paymentwall.com/brick/brick.1.4.js"> </script>
<div id="payment-form-container"> </div>
<script>
  var brick = new Brick({
    public_key: 'YOUR_PUBLIC_API_KEY',
    amount: 9.99,
    currency: 'USD',
    container: 'payment-form-container',
    action: 'billing.php',
    form: {
      merchant: 'Merchant Name',
      product: 'Product Name',
      pay_button: 'Pay',
      zip: true
    }
  });

  brick.showPaymentForm(function(data) {
    // handle success
  }, function(errors) {
    // handle errors
  });
</script>

